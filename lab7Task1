public class Main {

    static class Node {
        int key;
        Node left, right, parent;
        boolean color; 

        Node(int key) {
            this.key = key;
            this.color = true; 
        }
    }

    static class RBTree {
        private Node root;
        private final boolean RED = true;
        private final boolean BLACK = false;

        // ===== Insert =====
        public void insert(int key) {
            Node node = new Node(key);
            root = bstInsert(root, node);
            fixInsert(node);
        }

        private Node bstInsert(Node root, Node node) {
            if (root == null) return node;
            if (node.key < root.key) {
                root.left = bstInsert(root.left, node);
                root.left.parent = root;
            } else {
                root.right = bstInsert(root.right, node);
                root.right.parent = root;
            }
            return root;
        }

        private void fixInsert(Node node) {
            Node parent, grandparent;
            while (node != root && node.parent.color == RED) {
                parent = node.parent;
                grandparent = parent.parent;
                if (parent == grandparent.left) {
                    Node uncle = grandparent.right;
                    if (uncle != null && uncle.color == RED) {
                        parent.color = BLACK;
                        uncle.color = BLACK;
                        grandparent.color = RED;
                        node = grandparent;
                    } else {
                        if (node == parent.right) {
                            node = parent;
                            leftRotate(node);
                        }
                        parent.color = BLACK;
                        grandparent.color = RED;
                        rightRotate(grandparent);
                    }
                } else {
                    Node uncle = grandparent.left;
                    if (uncle != null && uncle.color == RED) {
                        parent.color = BLACK;
                        uncle.color = BLACK;
                        grandparent.color = RED;
                        node = grandparent;
                    } else {
                        if (node == parent.left) {
                            node = parent;
                            rightRotate(node);
                        }
                        parent.color = BLACK;
                        grandparent.color = RED;
                        leftRotate(grandparent);
                    }
                }
            }
            root.color = BLACK;
        }

        private void leftRotate(Node node) {
            Node rightChild = node.right;
            node.right = rightChild.left;
            if (rightChild.left != null) rightChild.left.parent = node;
            rightChild.parent = node.parent;
            if (node.parent == null) root = rightChild;
            else if (node == node.parent.left) node.parent.left = rightChild;
            else node.parent.right = rightChild;
            rightChild.left = node;
            node.parent = rightChild;
        }

        private void rightRotate(Node node) {
            Node leftChild = node.left;
            node.left = leftChild.right;
            if (leftChild.right != null) leftChild.right.parent = node;
            leftChild.parent = node.parent;
            if (node.parent == null) root = leftChild;
            else if (node == node.parent.left) node.parent.left = leftChild;
            else node.parent.right = leftChild;
            leftChild.right = node;
            node.parent = leftChild;
        }

        
        public void preorder(Node node) {
            if (node == null) return;
            System.out.print(node.key + (node.color ? "(R) " : "(B) "));
            preorder(node.left);
            preorder(node.right);
        }

        public void inorder(Node node) {
            if (node == null) return;
            inorder(node.left);
            System.out.print(node.key + (node.color ? "(R) " : "(B) "));
            inorder(node.right);
        }

        public void postorder(Node node) {
            if (node == null) return;
            postorder(node.left);
            postorder(node.right);
            System.out.print(node.key + (node.color ? "(R) " : "(B) "));
        }

        public Node getRoot() { return root; }
    }

    public static void main(String[] args) {
        int[] data = {54, 65, 7, 33, 86, 29, 11, 91, 12};
        RBTree tree = new RBTree();

        for (int x : data) tree.insert(x);

        System.out.println("PRE-ORDER:");
        tree.preorder(tree.getRoot());
        System.out.println("\nIN-ORDER:");
        tree.inorder(tree.getRoot());
        System.out.println("\nPOST-ORDER:");
        tree.postorder(tree.getRoot());
    }
}
